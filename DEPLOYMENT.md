# SwarmVille - Deployment Guide

## Overview

SwarmVille can be deployed across multiple platforms:
- **macOS**: Intel & Apple Silicon (.dmg, .app)
- **Windows**: x64 (.msi, .exe)
- **Linux**: x64, ARM64 (.deb, .AppImage)

## Prerequisites

- Completed local build: `npm run tauri build`
- GitHub repository set up
- Code signing certificates (macOS/Windows)
- GitHub Actions enabled

## Platform-Specific Setup

### macOS Code Signing

```bash
# Create signing certificate
security find-identity -v -p codesigning

# Set in tauri.conf.json
{
  "tauri": {
    "bundle": {
      "macOS": {
        "certificateCommonName": "Your Name",
        "signingIdentity": "Developer ID Application: ..."
      }
    }
  }
}
```

### Windows Code Signing

```bash
# Install Windows SDK
# Then in tauri.conf.json
{
  "tauri": {
    "bundle": {
      "windows": {
        "certificatePath": null,
        "certificatePassword": null,
        "signingIdentity": null,
        "timestampUrl": "http://timestamp.digicert.com"
      }
    }
  }
}
```

### Linux Packaging

No special setup required. Builds automatically create:
- `.deb` files for Debian/Ubuntu
- `.AppImage` for universal Linux

## Release Process

### 1. Version Bump

```bash
# Update version in package.json
npm version patch|minor|major

# Update version in src-tauri/Cargo.toml
# Update version in src-tauri/tauri.conf.json
```

### 2. Create Release Branch

```bash
git checkout -b release/v0.1.0
git push origin release/v0.1.0
```

### 3. GitHub Actions Build

Automatic on push to main or release branches:

```yaml
# .github/workflows/release.yml
name: Release

on:
  push:
    branches: [main, release/**]
    tags: ['v*']

jobs:
  release:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]
    steps:
      - uses: actions/checkout@v3
      - uses: ./.github/actions/setup
      - run: npm run tauri build
      - uses: softprops/action-gh-release@v1
```

### 4. Create Release

```bash
# Tag the release
git tag v0.1.0
git push origin v0.1.0

# GitHub Actions will build and publish
# artifacts automatically
```

## Distribution Channels

### GitHub Releases

Recommended for desktop apps. Features:
- Automatic updates via Tauri updater
- Cross-platform support
- Release notes
- Asset management

```bash
# Manual upload (if Actions fails)
gh release upload v0.1.0 \
  src-tauri/target/release/bundle/macos/*.dmg \
  src-tauri/target/release/bundle/windows/*.msi \
  src-tauri/target/release/bundle/deb/*.deb
```

### Homebrew

```bash
# Create brew formula
# File: swarmville.rb
class Swarmville < Formula
  desc "AI Agent Collaboration in 2D Spatial Workspaces"
  homepage "https://github.com/yourusername/swarm-ville"
  version "0.1.0"
  url "https://github.com/yourusername/swarm-ville/releases/download/v#{version}/SwarmVille_#{version}_x64.msi.zip"
  sha256 "YOUR_HASH_HERE"

  depends_on "rust"

  def install
    bin.install "SwarmVille"
  end
end

# Submit to homebrew-core
# Or create custom tap: homebrew-swarmville
```

### Windows Store

```bash
# Prepare MSIX package
npm run tauri build -- --config-path src-tauri/tauri.conf.json

# Submit to Microsoft Store
# Requires developer account and certificates
```

### Linux Distribution

#### Snap

```bash
# snapcraft.yaml
name: swarmville
version: '0.1.0'
summary: AI Agent Collaboration
description: |
  SwarmVille is a desktop app for collaborative
  AI agent orchestration in 2D spaces.

grade: stable
confinement: strict

parts:
  swarmville:
    plugin: rust
    source: .
```

#### AppImage

```bash
# Automatically generated by Tauri
# Located at: src-tauri/target/release/bundle/appimage/

# Distribute via:
# - GitHub Releases
# - AppImageHub
# - Custom download page
```

## Auto-Updates

### Setup Update Server

1. Create GitHub release with artifacts
2. Configure `updater` in `tauri.conf.json`:

```json
{
  "tauri": {
    "updater": {
      "active": true,
      "dialog": true,
      "direct": false,
      "endpoints": [
        "https://releases.example.com/latest.json"
      ],
      "windows": {
        "installMode": "silent"
      }
    }
  }
}
```

3. Create `latest.json` endpoint:

```json
{
  "version": "0.1.0",
  "notes": "New features and bug fixes",
  "pub_date": "2024-01-01T00:00:00Z",
  "platforms": {
    "darwin": {
      "signature": "dW50cnVzdGVkIGNvbW1lbnQ6IHRpbWVzdGFt...",
      "url": "https://github.com/.../SwarmVille.app.tar.gz"
    },
    "linux": {
      "signature": "...",
      "url": "https://github.com/.../swarmville_0.1.0_amd64.AppImage.tar.gz"
    },
    "windows": {
      "signature": "...",
      "url": "https://github.com/.../SwarmVille_0.1.0_x64.msi.zip"
    }
  }
}
```

## Signature Generation

```bash
# Install tauri-cli with updater support
npm install -g @tauri-apps/cli

# Generate signing key
tauri signer generate --write-keys

# Sign artifacts
tauri signer sign path/to/artifact \
  --secret-key ~/.tauri/env/.env
```

## Monitoring

### Usage Analytics

```bash
# Enable optional telemetry (with user consent)
# In src/stores/userStore.ts
privacy: {
  analytics: true,  // Only if user opts in
  cloudSync: false,
  shareUsageData: false,
}
```

### Crash Reports

Optional integration with:
- Sentry: Error tracking
- LogRocket: User session replay
- Custom server: Self-hosted analytics

## Security Considerations

### Code Signing
- All binaries must be signed
- Keep signing keys secure
- Use environment variables for CI/CD

### TLS Certificates
- Use HTTPS for update endpoints
- Pin certificates for security
- Validate signatures before installing updates

### Permissions
- Request minimal permissions
- Document why each permission is needed
- Allow users to deny permissions

### Dependency Auditing

```bash
# Check for vulnerabilities
npm audit
cargo audit

# Fix issues
npm audit fix
cargo update
```

## Rollback Procedure

If a release has critical issues:

```bash
# Create hotfix branch
git checkout -b hotfix/v0.1.1
git commit -am "fix: critical issue"
git tag v0.1.1
git push origin hotfix/v0.1.1 v0.1.1

# Update latest.json to point to previous version
# Users will be notified of the fix
```

## Metrics

### Success Criteria

- [ ] All platforms build successfully
- [ ] Code signing passes
- [ ] Update mechanism works
- [ ] <500MB bundle size
- [ ] <2s startup time
- [ ] <30MB base install

### Monitoring

```bash
# Track downloads
gh release view v0.1.0

# Monitor crashes (if integrated)
# Check Sentry/LogRocket dashboard

# User feedback
# Monitor GitHub issues and discussions
```

## Troubleshooting

### Build Fails on CI
```bash
# Check logs in GitHub Actions
# Ensure all signing keys are set
# Verify Rust version compatibility
rustup update stable
```

### Update Not Offered
- Verify updater enabled in tauri.conf.json
- Check latest.json endpoint is accessible
- Verify signature is correct
- Check version comparison logic

### Signature Mismatch
```bash
# Regenerate signature
tauri signer sign path/to/artifact --secret-key path/to/key

# Verify
tauri signer verify path/to/artifact \
  --public-key path/to/public/key
```

## Checklist for Release

- [ ] Version bumped in all files
- [ ] Changelog updated
- [ ] Tests passing
- [ ] Code reviewed
- [ ] Security audit passed
- [ ] Build artifacts generated
- [ ] Code signing verified
- [ ] Release notes written
- [ ] GitHub release created
- [ ] Announcement posted
- [ ] Update server updated
- [ ] Monitoring configured
- [ ] Rollback plan ready

---

For more information, see:
- [Tauri Documentation](https://tauri.app/v1/guides/distribution/)
- [OpenSpec Deployment](openspec/specs/04-mvp-scope.md#deployment)
- Release history: `CHANGELOG.md`
